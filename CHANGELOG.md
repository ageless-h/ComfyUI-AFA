# 更新日志 (Changelog)

本文档记录了ComfyUI-AFA项目的所有重要更新和变更。

## [v1.2.2] - 2025-10-18

### 新增功能 (Added)
- ✨ **飞书表格集成**：新增完整的飞书表格操作功能模块
  - 新增**飞书配置**节点：配置飞书应用凭据和表格URL，自动提取表格ID
  - 新增**飞书读取数据**节点：从飞书表格中读取指定单元格数据，支持强制刷新
  - 新增**飞书写入数据**节点：向飞书表格的指定单元格写入数据
  - 新增**飞书读取数据差**节点：计算表格中指定行或列的数据差值，用于数据分析
  - 新增**飞书上传图像**节点：将图像上传到飞书表格，支持单元格内图像和浮动图片模式
  - 支持飞书开放平台API集成，需要配置app_id和app_secret

### 移除功能 (Removed)
- 🗑️ **Suno音乐生成器**：移除旧版Suno音乐生成器节点
  - 删除 `suno_generator.py` 文件
  - 移除相关的节点注册和导入代码
  - 保留其他Suno音乐功能（音乐生成器、续写器、翻唱器）

### 代码清理 (Cleanup)
- 🧹 **代码优化**：清理未使用的导入和注册代码
- 📝 **文档更新**：更新相关文档以反映节点变更，添加飞书配置说明

## [v1.2.1] - 2025-10-13

### 新增功能 (Added)
- ✨ **PSD文件支持**：添加完整的PSD文件导入导出功能
  - 新增**导入PSD文档**节点 (AFA2D/图层IO)：支持从PSD文件导入完整文档结构
  - 新增**导出PSD文档**节点 (AFA2D/图层IO)：支持将文档导出为PSD格式
- ✨ **文件选择器界面**：导入PSD节点支持可视化文件选择
  - 移除文字输入框，只保留文件选择按钮
  - 自动显示已选择的文件名
  - 支持拖拽上传PSD文件
- ✨ **PSD解析功能**：
  - 自动解析PSD文件中的所有图层信息
  - 保持原始图层结构、名称、位置和属性
  - 支持图层透明度和混合模式
  - 可选择是否保持原始尺寸

### 技术改进 (Improved)
- 🚀 **前端集成**：添加JavaScript扩展支持PSD文件上传
- 🔧 **文件处理**：集成psd-tools库进行PSD文件解析
- 🎨 **用户体验**：优化节点界面，隐藏不必要的输入框
- 📁 **文件管理**：支持ComfyUI的文件上传系统

### 修复 (Fixed)
- 🐛 **JavaScript注册**：修复前端扩展注册问题，确保JavaScript文件正确加载
- 🐛 **节点名称**：修复JavaScript中的节点名称匹配问题
- 🐛 **Widget访问**：修复JavaScript中widget的访问方式

## [v1.2.0] - 2025-10-12

### 新增功能 (Added)
- ✨ **2D动画工具系统**：添加完整的图层编辑和预览功能
  - 新增10个图层编辑节点 (AFA2D/图层编辑)
  - 新增2个图层工具节点 (AFA2D/图层工具)
- ✨ **图层编辑节点**：
  - 创建空白文档：创建指定尺寸的空白文档对象
  - 创建图层：创建包含图像、位置、透明度等属性的图层对象
  - 添加图层到文档：将图层添加到文档中，自动分配图层ID
  - 删除图层：从文档中删除指定图层
  - 从文档获取图层：根据图层名或ID从文档中提取单个图层
  - 从文档获取图层列表：获取文档中所有图层的列表
  - 解包图层：将图层对象分解为各个属性
  - 更新图层：修改图层的属性
  - 获取文档信息：显示文档的画布尺寸、图层数量等信息
  - 获取图层信息：显示图层的详细属性信息
- ✨ **图层工具节点**：
  - 预览文档：渲染整个文档或指定图层的最终效果
  - 预览图层：预览单个图层的效果
- ✨ **混合模式系统**：支持12种专业混合模式
  - 正常 (normal)、正片叠底 (multiply)、滤色 (screen)
  - 叠加 (overlay)、柔光 (soft_light)、强光 (hard_light)
  - 颜色减淡 (color_dodge)、颜色加深 (color_burn)
  - 变暗 (darken)、变亮 (lighten)、差值 (difference)、排除 (exclusion)

### 技术改进 (Improved)
- 🚀 **性能优化**：使用tensor直接存储图像数据，避免文件I/O操作
- 🎨 **渲染系统**：实现完整的图层混合算法，支持透明度和锚点定位
- 🌐 **用户体验**：添加中英文混合模式映射，提升易用性
- 📊 **数据结构**：设计了完整的文档和图层数据结构
- 🔧 **ID管理**：支持图层ID自动分配和管理
- 📝 **元数据系统**：添加元数据追踪，便于调试和维护

### 技术细节 (Technical Details)
- **数据存储**：主要使用`image_data`存储tensor，保留`image_path`向后兼容
- **图层结构**：包含layer_id、name、image_data、position、size、anchor、opacity、visible、blend_mode、metadata
- **文档结构**：包含document_id、version、canvas_size、layers、metadata
- **混合算法**：实现了完整的alpha合成和专业混合模式

## [v1.1.0] - 2025-10-03

### 新增功能 (Added)
- ✨ **Suno音乐生成器**：支持基于文本描述生成音乐
- ✨ **音频时长控制**：可设置10-180秒的音频时长范围
- ✨ **音乐标签系统**：支持多个标签组合，提升音乐生成精度

### 改进 (Improved)
- 🎵 **音频格式优化**：使用3D张量格式`[batch, channels, samples]`
- 🔧 **兼容性修复**：修复与ComfyUI官方PreviewAudio节点的兼容性问题
- 🌐 **API支持**：改进API响应处理，支持t8平台的Suno API格式

### 重构 (Refactored)
- 📁 **节点分类重组**：将所有节点迁移到AFA命名空间下
  - LLM/VLM节点 → `AFA/大模型`分类
  - 配置选择器节点 → `AFA/config`分类
  - 用户输入节点 → `AFA/输入`分类
  - 图像编辑节点 → `AFA/图像`分类
  - 音乐生成节点 → `AFA/音乐`分类

## [v1.0.0] - 2025-09-15

### 新增功能 (Added)
- ✨ **首次发布**：ComfyUI-AFA插件正式发布
- ✨ **LLM文本生成**：集成大语言模型，支持多种创作任务
- ✨ **VLM图像分析**：集成视觉语言模型，支持图像分析和描述
- ✨ **图像编辑**：支持基于文本提示的图像编辑功能
- ✨ **创作辅助模板**：提供世界观构建、角色档案、救猫咪结构等专业模板
- ✨ **多API支持**：支持多种在线API服务集成
- ✨ **配置系统**：提供灵活的API密钥、URL和模型配置

### 技术特性 (Technical Features)
- 🔧 **模块化设计**：采用模块化架构，便于扩展和维护
- 📝 **配置文件系统**：支持JSON格式的配置文件
- 🎯 **统一接口**：所有节点采用统一的AFA分类
- 🔒 **安全性**：支持API密钥安全管理

---

## 版本说明 (Version Notes)

- **主版本号**：重大功能更新或架构变更
- **次版本号**：新功能添加或重要改进
- **修订版本号**：bug修复和小幅改进

## 贡献指南 (Contributing)

如果您想为项目贡献代码或报告问题，请访问我们的GitHub仓库。

## 许可证 (License)

本项目采用MIT许可证，详情请参阅LICENSE文件。